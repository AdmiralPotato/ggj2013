<!DOCTYPE html>
<html>
<head>
<title>Global Game Jam 2013</title>
<style></style>
</head>
<body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script type = "text/javascript" src = "http://stemkoski.github.com/Three.js/js/Three.js">
</script>
<script>

	window.requestAnimFrame = (function(){
		return  window.requestAnimationFrame       || 
			window.webkitRequestAnimationFrame || 
			window.mozRequestAnimationFrame    || 
			window.oRequestAnimationFrame      || 
			window.msRequestAnimationFrame     || 
			function( callback ){
				window.setTimeout(callback, 1000 / 60);
			};
	})();

	var width = window.innerWidth;
	var height = window.innerHeight;
	
	var scene = new THREE.Scene();
	var camera = new THREE.PerspectiveCamera(50, width/height, 0.1, 1000);

	var rend = new THREE.WebGLRenderer();
	rend.setSize(width, height);
	document.body.appendChild(rend.domElement);
	
	var geometryObjects = {};
	var parseAllGeometry = function(_geoPath, _callback) {
		var propertyName, modelData, modelCount = 0, modelsLoaded = 0;
		
		for(propertyName in _geoPath){
			if(_geoPath.hasOwnProperty(propertyName)){
				
				modelCount += 1;
				modelData = _geoPath[propertyName];
				
				
				function createMesh(_propertyName){
					var meshCreationHandler = function(_geometry) {
						geometryObjects[_propertyName] = _geometry;
						modelsLoaded += 1;
					
						console.log(_propertyName+":"+modelsLoaded+":"+modelCount);
					
						if(modelsLoaded === modelCount){
							_callback();
						}
					};
					var jsonLoader = new THREE.JSONLoader();
					jsonLoader.load(modelData, meshCreationHandler);
				}
				createMesh(propertyName);
			}
		}
	}

	var whatToDoWhenAllTheGeometriesAreParsedOkayYupSeriously = function(){
		
		var myMesh = new THREE.Mesh(geometryObjects.fishShip, geometryObjects.fishShip.materials[0]);
		myMesh.rotation.set(0,0,0);
		scene.add(myMesh);

	};
	var light = new THREE.PointLight(0xffffff,1.5);
	light.position.z=512;
	scene.add(light);
	
	
	parseAllGeometry(
		{
			'fishShip': "../models/fishShip.js",
		},
		whatToDoWhenAllTheGeometriesAreParsedOkayYupSeriously
	);
	
	var render = function(){
		requestAnimFrame(render);
		if(window.innerWidth != width || window.innerHeight != height){
			width = window.innerWidth;
			height = window.innerHeight;
			camera.aspect = width/height;
			camera.updateProjectionMatrix()
			rend.setSize(width, height);
		}
		//camera.position.z = 50;
		camera.position = distanceElevationHeading(50, 45, 0);

		camera.lookAt(new THREE.Vector3(0,0,0));

		rend.render(scene, camera);
	}
	var distanceElevationHeading = function (_distance, _elevation, _heading){
		var radH = deg2Rad(_heading-90);
		var radE = deg2Rad(_elevation);
		var a = _distance * Math.cos(radE);
		return new THREE.Vector3(a*Math.cos(radH), _distance*Math.sin(radE), -a*Math.sin(radH));
	}
	var deg2Rad = function(_deg){
		return (_deg/180)*Math.PI;
	}
	var rad2Deg = function(_rad){
		return (_rad*180)/Math.PI;
	}
	render();
</script>
</body>